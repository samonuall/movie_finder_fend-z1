#!/usr/bin/env sh

# Add Node.js from nvm to PATH
export PATH="/Users/samonuallain/.nvm/versions/node/v20.17.0/bin:$PATH"

# Load NVM
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

echo "üé£ Running pre-commit checks..."

# Run lint-staged (lints and auto-fixes staged files)
if pnpm exec lint-staged; then
  echo "‚úÖ Linting passed"
else
  echo "‚ö†Ô∏è  Linting had issues, but allowing commit to proceed"
fi

# Update lockfile if package.json changed
if git diff --cached --name-only | grep -q "package.json"; then
  echo "üì¶ package.json changed, updating lockfile..."
  pnpm install --lockfile-only
  git add pnpm-lock.yaml
fi

echo "‚úÖ Pre-commit checks complete"
exit 0
