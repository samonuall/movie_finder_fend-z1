#!/usr/bin/env sh

# Load conda environment
if [ -f "$HOME/anaconda3/etc/profile.d/conda.sh" ]; then
    . "$HOME/anaconda3/etc/profile.d/conda.sh"
fi

# Add common paths where Node.js and pnpm might be
export PATH="$HOME/anaconda3/bin:$HOME/anaconda3/condabin:/opt/homebrew/bin:/usr/local/bin:$PATH"

# Run lint-staged (lints and auto-fixes staged files)
pnpm exec lint-staged || echo "‚ö†Ô∏è Lint-staged failed, but continuing..."

# Update lockfile if package.json changed
if git diff --cached --name-only | grep -q "package.json"; then
  echo "üì¶ package.json changed, updating lockfile..."
  pnpm install --lockfile-only || echo "‚ö†Ô∏è Failed to update lockfile"
  git add pnpm-lock.yaml
fi
