#!/usr/bin/env sh

# Add Node.js from nvm to PATH
export PATH="/Users/samonuallain/.nvm/versions/node/v20.17.0/bin:$PATH"

# Load NVM
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

echo "🎣 Running pre-commit checks..."

# Run lint-staged with --no-stash to prevent losing changes
# This means you should only have staged changes when committing
pnpm exec lint-staged --no-stash || {
  echo "❌ Linting failed! Please review and fix the errors."
  echo "💡 Your changes are preserved. Run 'git status' to see what happened."
  exit 1
}
echo "✅ Linting passed"

# Update lockfile if package.json changed
if git diff --cached --name-only | grep -q "package.json"; then
  echo "📦 package.json changed, updating lockfile..."
  pnpm install --lockfile-only
  git add pnpm-lock.yaml
fi

echo "✅ Pre-commit checks complete"
exit 0
