#!/usr/bin/env sh

# Load NVM and use the correct Node/pnpm version
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"

# Use the specific pnpm path from your nvm installation
PNPM_CMD="/Users/samonuallain/.nvm/versions/node/v20.17.0/bin/pnpm"

echo "ðŸŽ£ Running pre-commit checks..."

# Run lint-staged (lints and auto-fixes staged files)
$PNPM_CMD exec lint-staged

# Update lockfile if package.json changed
if git diff --cached --name-only | grep -q "package.json"; then
  echo "ðŸ“¦ package.json changed, updating lockfile..."
  $PNPM_CMD install --lockfile-only
  git add pnpm-lock.yaml
fi

echo "âœ… Pre-commit checks complete"
